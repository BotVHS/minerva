<div class="dashboard-container">
  <h1 class="page-title">Dashboard</h1>

  <div class="welcome-message" *ngIf="currentUser">
    <h2>Benvingut/da, {{ currentUser.fullName }}!</h2>
    <p>Ãšltim accÃ©s: {{ formatDate(currentUser.lastLoginAt || new Date().toISOString()) }}</p>
  </div>

  <!-- Loading state -->
  <div class="loading-spinner" *ngIf="loading">
    <div class="spinner"></div>
    <p>Carregant dades...</p>
  </div>

  <!-- Error state -->
  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
  </div>

  <!-- Stats Cards (Admin only) -->
  <div class="stats-grid" *ngIf="!loading && hasRole('ADMIN')">
    <div class="stat-card">
      <div class="stat-icon users">ðŸ‘¥</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.totalUsers }}</div>
        <div class="stat-label">Total Usuaris</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon active">âœ“</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.activeUsers }}</div>
        <div class="stat-label">Usuaris Actius</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon security">ðŸ”’</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.usersWithTwoFA }}</div>
        <div class="stat-label">Amb 2FA</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon logins">ðŸ“Š</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.recentLogins }}</div>
        <div class="stat-label">Logins (24h)</div>
      </div>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="recent-activity" *ngIf="!loading && (hasRole('ADMIN') || hasRole('SUPERVISOR'))">
    <h3>Activitat Recent</h3>

    <div class="activity-list" *ngIf="stats.recentAuditLogs.length > 0">
      <div class="activity-item" *ngFor="let log of stats.recentAuditLogs" [class]="getActionClass(log.action)">
        <div class="activity-icon">
          <span *ngIf="log.success">âœ“</span>
          <span *ngIf="!log.success">âœ—</span>
        </div>
        <div class="activity-content">
          <div class="activity-action">{{ getActionLabel(log.action) }}</div>
          <div class="activity-details">
            <span class="username" *ngIf="log.username">{{ log.username }}</span>
            <span class="separator" *ngIf="log.username && log.ipAddress">â€¢</span>
            <span class="ip" *ngIf="log.ipAddress">{{ log.ipAddress }}</span>
          </div>
        </div>
        <div class="activity-time">{{ formatDate(log.timestamp) }}</div>
      </div>
    </div>

    <div class="empty-state" *ngIf="stats.recentAuditLogs.length === 0">
      <p>No hi ha activitat recent</p>
    </div>

    <div class="view-all-link">
      <a routerLink="/audit">Veure tots els logs d'auditoria â†’</a>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions" *ngIf="!loading">
    <h3>Accions RÃ pides</h3>
    <div class="actions-grid">
      <a routerLink="/users" class="action-card" *ngIf="hasRole('ADMIN')">
        <div class="action-icon">ðŸ‘¥</div>
        <div class="action-title">Gestionar Usuaris</div>
        <div class="action-description">Crear, editar i eliminar usuaris</div>
      </a>

      <a routerLink="/audit" class="action-card" *ngIf="hasRole('ADMIN') || hasRole('SUPERVISOR')">
        <div class="action-icon">ðŸ“‹</div>
        <div class="action-title">Auditoria</div>
        <div class="action-description">Revisar logs del sistema</div>
      </a>
    </div>
  </div>

  <!-- System Info -->
  <div class="system-info" *ngIf="!loading">
    <h3>InformaciÃ³ del Sistema</h3>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">VersiÃ³:</span>
        <span class="info-value">1.0.0</span>
      </div>
      <div class="info-item">
        <span class="info-label">Entorn:</span>
        <span class="info-value">ProducciÃ³</span>
      </div>
      <div class="info-item" *ngIf="currentUser">
        <span class="info-label">Rol:</span>
        <span class="info-value">{{ currentUser.roles.join(', ') }}</span>
      </div>
      <div class="info-item" *ngIf="currentUser">
        <span class="info-label">2FA:</span>
        <span class="info-value" [class.enabled]="currentUser.twoFactorEnabled">
          {{ currentUser.twoFactorEnabled ? 'Activat âœ“' : 'Desactivat' }}
        </span>
      </div>
    </div>
  </div>
</div>
